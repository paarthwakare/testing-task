index.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bottle of Water - Level Control</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0e1320;
      --panel:#151b2e;
      --accent:#4cc3ff;
      --accent-2:#1aa0ff;
      --glass:#a0b3c7;
      --glass-edge:#7f93a9;
      --text:#eaf2ff;
      --muted:#a7b4c8;
      --btn:#1f2741;
      --btn-hover:#2a3558;
      --danger:#ff4d6d;
      --ok:#29d391;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 70% -10%, #1a2242 0%, #0b0f1c 60%, var(--bg) 100%);
      color:var(--text);
      font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:grid;
      place-items:center;
      padding:24px;
    }
    .app{
      width:min(100%, 980px);
      display:grid;
      gap:18px;
      grid-template-columns: 1fr 360px;
      align-items:center;
    }
    @media (max-width:900px){
      .app{grid-template-columns: 1fr}
    }
    .stage{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.06);
      border-radius:16px;
      padding:18px;
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
    }
    .panel{
      background: var(--panel);
      border:1px solid rgba(255,255,255,0.06);
      border-radius:16px;
      padding:16px;
    }
    .title{
      margin:0 0 8px 0;
      font-weight:700;
      letter-spacing:.2px;
    }
    .bottle-wrap{
      width:min(420px, 80vw);
      aspect-ratio: 3/5.2;
      display:grid;
      place-items:center;
      position:relative;
      cursor:grab;
      user-select:none;
    }
    .hint{
      position:absolute;
      bottom:10px;
      left:50%;
      transform:translateX(-50%);
      font-size:12px;
      color:var(--muted);
      background: rgba(0,0,0,0.25);
      border:1px solid rgba(255,255,255,0.06);
      padding:6px 10px;
      border-radius:999px;
      backdrop-filter: blur(6px);
    }
    .readout{
      display:flex;
      align-items:baseline;
      gap:10px;
      margin:4px 0 14px 0;
    }
    .readout .percent{
      font-size:44px;
      font-weight:800;
      letter-spacing:-.5px;
    }
    .readout .ml{
      font-size:14px;
      color:var(--muted);
      padding-top:10px;
    }
    .controls{
      display:grid;
      gap:12px;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      background:var(--btn);
      color:var(--text);
      border:1px solid rgba(255,255,255,0.08);
      padding:10px 14px;
      border-radius:12px;
      font-weight:600;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
    }
    button:hover{ background:var(--btn-hover); }
    button:active{ transform: translateY(1px) scale(.99); }
    button.primary{
      background: linear-gradient(180deg, var(--accent) 0%, var(--accent-2) 100%);
      color:#06263a;
      border-color: transparent;
    }
    button.good{ background: linear-gradient(180deg, #37f1b9 0%, #18c68f 100%); color:#053a2a; }
    button.danger{ background: linear-gradient(180deg, #ff7a90 0%, #ff4d6d 100%); color:#3f0410; }
    .slider-wrap{
      background: rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:12px;
      padding:10px 12px;
    }
    input[type=range]{
      width:100%;
      accent-color: var(--accent);
    }
    .tip{
      color:var(--muted);
      font-size:12px;
      line-height:1.3;
    }
    .kbd{
      display:inline-block;
      padding:2px 6px;
      border-radius:6px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:12px;
    }

    /* SVG effects */
    .bottle-outline{
      filter: drop-shadow(0 10px 22px rgba(0,0,0,0.35));
    }
    .shine{
      opacity:.18;
    }
    .tickline{
      stroke: rgba(255,255,255,0.12);
      stroke-width: 1.2;
    }
    .water-grad stop:first-child{ stop-color:#7bd6ff }
    .water-grad stop:last-child{ stop-color:#1aa0ff }

    .wave{
      opacity:.55;
      animation: drift 4.5s linear infinite;
      transform-origin: center;
    }
    .wave.wave2{
      opacity:.40;
      animation-duration: 7.5s;
      animation-direction: reverse;
    }
    @keyframes drift{
      from{ transform: translateX(0) }
      to{ transform: translateX(-160px) }
    }
    .bubble{
      fill: rgba(255,255,255,0.45);
      animation: rise 6s ease-in infinite;
    }
    @keyframes rise{
      0%{ opacity:0; transform: translateY(0) scale(0.8)}
      15%{ opacity:.8 }
      100%{ opacity:0; transform: translateY(-160px) scale(1.2)}
    }

    .sr-only{
      position:absolute !important;
      left:-10000px !important;
      width:1px; height:1px;
      overflow:hidden;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="stage" aria-labelledby="title">
      <div class="bottle-wrap" id="bottleArea" title="Scroll or drag up/down to adjust.">
        <svg id="bottleSvg" viewBox="0 0 240 480" width="100%" height="100%" role="img" aria-describedby="desc">
          <title id="title">Bottle of Water</title>
          <desc id="desc">Interactive bottle that shows fill level as percentage and milliliters. Use buttons, slider, mouse wheel, or drag vertically to adjust the water level.</desc>

          <defs>
            <!-- Bottle silhouette path definition reused as clip -->
            <path id="bottlePath"
              d="M95 28
                 L145 28
                 Q151 28 151 34
                 Q151 40 145 40
                 L145 74
                 Q176 92 183 120
                 Q188 138 188 148
                 L188 350
                 Q188 404 120 404
                 Q52 404 52 350
                 L52 148
                 Q52 138 57 120
                 Q64 92 95 74
                 L95 40
                 Q89 40 89 34
                 Q89 28 95 28 Z" />

            <clipPath id="clip-bottle">
              <use href="#bottlePath" />
            </clipPath>

            <clipPath id="clip-level">
              <rect id="levelClipRect" x="40" y="250" width="160" height="150" rx="0" ry="0" />
            </clipPath>

            <linearGradient id="waterGradient" x1="0" y1="0" x2="0" y2="1" class="water-grad">
              <stop offset="0%" />
              <stop offset="100%" />
            </linearGradient>

            <filter id="innerGlow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="2.5" result="blur"/>
              <feComposite in="blur" in2="SourceAlpha" operator="out" result="inner"/>
              <feColorMatrix in="inner" type="matrix" values="0 0 0 0 0.9  0 0 0 0 1  0 0 0 0 1  0 0 0 0.6 0" result="color"/>
              <feComposite in="color" in2="SourceGraphic" operator="over"/>
            </filter>
          </defs>

          <!-- Tick marks for reference -->
          <g opacity="0.6" transform="translate(0,0)">
            <line class="tickline" x1="190" x2="204" y1="148" y2="148"/>
            <line class="tickline" x1="190" x2="204" y1="198" y2="198"/>
            <line class="tickline" x1="190" x2="204" y1="248" y2="248"/>
            <line class="tickline" x1="190" x2="204" y1="298" y2="298"/>
            <line class="tickline" x1="190" x2="204" y1="348" y2="348"/>
          </g>

          <!-- Water, clipped to bottle + level -->
          <g clip-path="url(#clip-bottle)">
            <g id="levelGroup" clip-path="url(#clip-level)">
              <rect x="40" y="0" width="160" height="460" fill="url(#waterGradient)"/>
              <!-- Waves -->
              <g transform="translate(40,0)">
                <path class="wave" fill="rgba(255,255,255,0.25)"
                  d="M0 0
                     c 20 8, 40 -8, 60 0
                     s 40 8, 60 0
                     s 40 -8, 60 0
                     s 40 8, 60 0
                     v 30 h -240 z" />
                <path class="wave wave2" fill="rgba(255,255,255,0.18)"
                  d="M0 6
                     c 18 8, 36 -8, 54 0
                     s 36 8, 54 0
                     s 36 -8, 54 0
                     s 36 8, 54 0
                     v 26 h -216 z" />
              </g>

              <!-- Random bubbles -->
              <g id="bubbles" transform="translate(0,0)">
                <circle class="bubble" cx="85" cy="360" r="2.6" style="animation-delay: .2s"/>
                <circle class="bubble" cx="110" cy="340" r="1.8" style="animation-delay: .8s"/>
                <circle class="bubble" cx="135" cy="370" r="1.6" style="animation-delay: 1.6s"/>
                <circle class="bubble" cx="160" cy="355" r="2.2" style="animation-delay: 1.1s"/>
                <circle class="bubble" cx="120" cy="380" r="1.9" style="animation-delay: 2.2s"/>
                <circle class="bubble" cx="148" cy="392" r="2.1" style="animation-delay: 2.7s"/>
              </g>
            </g>
          </g>

          <!-- Glass outline and shine -->
          <use href="#bottlePath" fill="none" stroke="var(--glass-edge)" stroke-width="2.6" class="bottle-outline"/>
          <path class="shine" fill="white" d="M84 70 q 8 8 8 30 v210 q 0 30 -8 40 q -6 10 -12 0 q 8 -22 8 -40 V100 q 0 -16 -8 -28 q 6 -14 12 -2 z" />

          <!-- Readout inside bottle -->
          <g id="insideReadout" pointer-events="none" transform="translate(0,0)">
            <text id="pctText" x="120" y="220" text-anchor="middle" font-size="42" font-weight="800" fill="rgba(255,255,255,0.95)">--%</text>
            <text id="mlText" x="120" y="245" text-anchor="middle" font-size="14" fill="rgba(255,255,255,0.7)">-- ml</text>
          </g>
        </svg>
        <div class="hint">Scroll, drag, or use buttons</div>
      </div>
    </div>

    <div class="panel">
      <h2 class="title">Controls</h2>
      <div class="readout" aria-live="polite">
        <div class="percent" id="percentLarge">--%</div>
        <div class="ml" id="mlLarge">-- ml of 1000 ml</div>
      </div>

      <div class="controls">
        <div class="row">
          <button id="decBtn" title="Decrease (5%)">-5%</button>
          <button id="incBtn" class="primary" title="Increase (5%)">+5%</button>
          <button id="emptyBtn" class="danger" title="Empty bottle">Empty</button>
          <button id="fullBtn" class="good" title="Fill bottle">Fill</button>
        </div>

        <div class="slider-wrap">
          <input type="range" id="levelSlider" min="0" max="100" step="1" value="0" aria-label="Water level slider (percent)">
        </div>

        <div class="tip">
          Tips:
          - Keyboard: <span class="kbd">↑</span>/<span class="kbd">↓</span> or <span class="kbd">W</span>/<span class="kbd">S</span>
          - Mouse: scroll on bottle
          - Touch/Mouse: drag up/down
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const svg = document.getElementById('bottleSvg');
      const bottlePath = document.getElementById('bottlePath');
      const levelClipRect = document.getElementById('levelClipRect');
      const pctText = document.getElementById('pctText');
      const mlText = document.getElementById('mlText');
      const percentLarge = document.getElementById('percentLarge');
      const mlLarge = document.getElementById('mlLarge');
      const slider = document.getElementById('levelSlider');
      const area = document.getElementById('bottleArea');

      const CAPACITY_ML = 1000;
      const STEP = 5;

      let bbox = null;
      let levelPercent = +localStorage.getItem('bottle.level') || 40;

      // Compute bottle inner bounds
      function computeBounds(){
        bbox = bottlePath.getBBox();
        // Expand width a bit so level clip covers curved edges
        const padX = 6;
        levelClipRect.setAttribute('x', Math.max(0, bbox.x - padX));
        levelClipRect.setAttribute('width', Math.min(svg.viewBox.baseVal.width, bbox.width + padX * 2));
      }

      function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

      // Set visual level (0..100)
      function setLevel(p, animate=true){
        p = Math.round(clamp(p, 0, 100));
        levelPercent = p;
        localStorage.setItem('bottle.level', String(levelPercent));

        // Map percentage to bottle vertical space
        const totalH = bbox.height;
        const heightPx = totalH * (p / 100);
        const y = (bbox.y + bbox.height) - heightPx;

        // For a tiny rounded top look on low levels
        const rx = Math.max(0, Math.min(12, (100 - p) / 6));
        levelClipRect.setAttribute('y', y.toFixed(2));
        levelClipRect.setAttribute('height', Math.max(0, heightPx).toFixed(2));
        levelClipRect.setAttribute('rx', rx.toFixed(1));
        levelClipRect.setAttribute('ry', rx.toFixed(1));

        // Update texts
        const ml = Math.round(CAPACITY_ML * p / 100);
        pctText.textContent = p + '%';
        mlText.textContent = ml + ' ml';
        percentLarge.textContent = p + '%';
        mlLarge.textContent = ml + ' ml of ' + CAPACITY_ML + ' ml';

        // Move inside readout to always be near the water surface
        const surfaceY = Math.max(bbox.y + 98, Math.min(bbox.y + bbox.height - 90, y + 28));
        document.getElementById('insideReadout')
          .setAttribute('transform', 'translate(0,' + (surfaceY - 200).toFixed(0) + ')');

        // Animate slight ripple on change
        if(animate){
          svg.style.filter = 'drop-shadow(0 12px 28px rgba(0,0,0,0.38))';
          clearTimeout(setLevel._t);
          setLevel._t = setTimeout(()=>{ svg.style.filter = 'drop-shadow(0 10px 22px rgba(0,0,0,0.35))'; }, 180);
        }

        // Sync slider without triggering input loop
        if (String(slider.value) !== String(p)) slider.value = String(p);
      }

      // Public API
      function increaseLevel(amount=STEP){ setLevel(levelPercent + amount); }
      function decreaseLevel(amount=STEP){ setLevel(levelPercent - amount); }
      window.increaseLevel = increaseLevel;
      window.decreaseLevel = decreaseLevel;

      // Controls
      const incBtn = document.getElementById('incBtn');
      const decBtn = document.getElementById('decBtn');
      const fullBtn = document.getElementById('fullBtn');
      const emptyBtn = document.getElementById('emptyBtn');

      incBtn.addEventListener('click', ()=>increaseLevel());
      decBtn.addEventListener('click', ()=>decreaseLevel());
      fullBtn.addEventListener('click', ()=>setLevel(100));
      emptyBtn.addEventListener('click', ()=>setLevel(0));

      slider.addEventListener('input', e=> setLevel(+e.target.value, false));

      // Press-and-hold behavior
      const holdable = [
        [incBtn, ()=>increaseLevel(1)],
        [decBtn, ()=>decreaseLevel(1)]
      ];
      holdable.forEach(([btn, action])=>{
        let timer=null;
        const start = ()=>{
          action();
          timer = setInterval(action, 90);
        };
        const stop = ()=>{ if(timer){ clearInterval(timer); timer=null; } };
        btn.addEventListener('mousedown', start);
        btn.addEventListener('touchstart', start, {passive:true});
        window.addEventListener('mouseup', stop);
        window.addEventListener('touchend', stop);
        window.addEventListener('touchcancel', stop);
        btn.addEventListener('mouseleave', stop);
      });

      // Keyboard support
      window.addEventListener('keydown', (e)=>{
        if (['ArrowUp','ArrowDown','w','W','s','S','PageUp','PageDown','Home','End'].includes(e.key)){
          e.preventDefault();
          if (e.key==='ArrowUp' || e.key==='w' || e.key==='W' || e.key==='PageUp') increaseLevel(1);
          if (e.key==='ArrowDown' || e.key==='s' || e.key==='S' || e.key==='PageDown') decreaseLevel(1);
          if (e.key==='Home') setLevel(0);
          if (e.key==='End') setLevel(100);
        }
      });

      // Scroll on bottle to adjust
      area.addEventListener('wheel', (e)=>{
        e.preventDefault();
        const delta = Math.sign(e.deltaY);
        if (delta > 0) decreaseLevel(2);
        else if (delta < 0) increaseLevel(2);
      }, {passive:false});

      // Drag up/down to pour/fill
      let dragging = false, startY = 0, startLevel = 0;
      const dragStart = (y)=>{
        dragging = true;
        startY = y;
        startLevel = levelPercent;
        area.style.cursor = 'grabbing';
      };
      const dragMove = (y)=>{
        if(!dragging) return;
        const dy = startY - y; // move up increases level
        const deltaPercent = dy / 3.0; // sensitivity
        setLevel(startLevel + deltaPercent, false);
      };
      const dragEnd = ()=>{
        dragging = false;
        area.style.cursor = 'grab';
      };
      area.addEventListener('mousedown', (e)=>dragStart(e.clientY));
      window.addEventListener('mousemove', (e)=>dragMove(e.clientY));
      window.addEventListener('mouseup', dragEnd);
      area.addEventListener('touchstart', (e)=>dragStart(e.touches[0].clientY), {passive:true});
      window.addEventListener('touchmove', (e)=>dragMove(e.touches[0].clientY), {passive:true});
      window.addEventListener('touchend', dragEnd);
      window.addEventListener('touchcancel', dragEnd);

      // Double click/tap toggle
      area.addEventListener('dblclick', ()=>{
        setLevel(levelPercent < 50 ? 100 : 0);
      });

      // Initialize
      function init(){
        computeBounds();

        // Color gradient based on theme variables
        const stops = svg.querySelectorAll('#waterGradient stop');
        stops[0].setAttribute('stop-color', getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#7bd6ff');
        stops[1].setAttribute('stop-color', getComputedStyle(document.documentElement).getPropertyValue('--accent-2').trim() || '#1aa0ff');

        setLevel(levelPercent, false);
        // Resize adjust (in case fonts/SVG layout changes)
        const ro = new ResizeObserver(()=>{
          computeBounds();
          setLevel(levelPercent, false);
        });
        ro.observe(area);
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>